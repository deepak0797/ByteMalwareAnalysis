import java.util.*;
import java.io.File;
import java.lang.Thread;

import soot.*;
import soot.BodyTransformer;
import soot.PackManager;
import soot.Transform;
import soot.SootClass;
import soot.SootMethod;
import soot.Unit;
import soot.jimple.InvokeExpr;
import soot.jimple.Jimple;
import soot.jimple.Stmt;
import soot.jimple.toolkits.callgraph.CallGraph;
import soot.jimple.toolkits.callgraph.ReachableMethods;
import soot.options.Options;
import soot.toolkits.graph.ExceptionalUnitGraph;
import soot.toolkits.graph.UnitGraph;
import soot.toolkits.scalar.ArraySparseSet;
import soot.toolkits.scalar.SmartLocalDefs;
import soot.util.queue.QueueReader;
import soot.toolkits.scalar.SimpleLiveLocals;
import soot.jimple.StaticInvokeExpr;
import soot.jimple.toolkits.annotation.purity.AbstractInterproceduralAnalysis;
import soot.jimple.toolkits.callgraph.CHATransformer;

public class SootAnalysis {

    public static HashSet<String> srcToSinkPairHashSet = new HashSet<>();
    public static void main(String[] args) {

        configureSoot("test");
        SourceSinkDetection.main(null);
        Scene.v().loadNecessaryClasses();
        CallGraphTransformer callGraphTransformer = new CallGraphTransformer();

        Pack pack = PackManager.v().getPack("wjtp");
        pack.add(new Transform("wjtp.bytecg", callGraphTransformer));
        pack.add(new Transform("wjtp.inter", ByteInterFlowTransformer.v()));

        PackManager.v().runPacks();
        // callGraphTransformer.printCG();
        System.out.println(srcToSinkPairHashSet);

    }

    public static void configureSoot(String classpath) {

        Options.v().set_whole_program(true);
        Options.v().set_allow_phantom_refs(false);
        Options.v().set_prepend_classpath(true);
        Options.v().set_src_prec(Options.src_prec_class);
        Options.v().set_output_format(Options.output_format_jimple);
        ArrayList<String> list = new ArrayList<>();
        list.add(classpath);
        Options.v().set_process_dir(list);
        Options.v().setPhaseOption("cg.spark", "on");
        // Options.v().set_app(true);
    }

}
